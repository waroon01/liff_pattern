<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>LIFF Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  </head>
  <body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen px-4 text-center">
    <h1 class="text-3xl sm:text-4xl font-bold mb-6">üëã Hello LIFF</h1>

    <div id="profile" class="hidden bg-white shadow-xl rounded-xl p-6 w-full max-w-sm">
      <img id="profileImage" src="" alt="Profile" class="rounded-full w-24 h-24 mx-auto mb-4" />
      <h2 id="profileName" class="text-lg sm:text-xl font-semibold"></h2>
      <h2 id="profileEmail" class="text-sm sm:text-base text-gray-600"></h2>
      <h2 id="profileStatus" class="text-sm sm:text-base text-gray-600 mb-4"></h2>

      <div class="flex flex-col gap-2">
        <button id="ShareBtn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
          üì§ Share
        </button>
        <button id="ScanBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
          üì∑ Scan QR
        </button>
        <button id="logoutBtn" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
          üîí Logout
        </button>
      </div>
    </div>

    <script>
      const liffId = "1657704109-x2l3rrY0";

      $(document).ready(() => {
        initializeLiff(liffId);
      });

      const initializeLiff = async (liffId) => {
        liff.init({ liffId }, async () => {
          liff.ready.then(async () => {
            if (!liff.isLoggedIn()) {
              const result = await Swal.fire({
                icon: 'info',
                title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ LINE ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',
                confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö',
                allowOutsideClick: false
              });
              if (result.isConfirmed) {
                liff.login({ redirectUri: location.href });
              }
              return;
            }

            const profile = await liff.getProfile();
            const idToken = liff.getDecodedIDToken();

            $("#profileImage").attr("src", idToken.picture);
            $("#profileName").text(`‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ${profile.displayName}`);
            $("#profileEmail").text(`${idToken.email}`);
            $("#profileStatus").text(`‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${profile.statusMessage ?? "-"}`);
            $("#profile").removeClass("hidden");

            $("#logoutBtn").on("click", () => {
              liff.logout();
              location.reload();
            });
          });
        });
      };

      document.getElementById("ShareBtn").addEventListener("click", async () => {
        const flex = {
          type: "flex",
          altText: "‡∏™‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡πà‡∏ß‡∏á‡πÉ‡∏¢‡∏ú‡πà‡∏≤‡∏ô LIFF üíö",
          contents: {
            type: "bubble",
            hero: {
              type: "image",
              url: "https://scdn.line-apps.com/n/channel_devcenter/img/fx/01_1_cafe.png",
              size: "full",
              aspectRatio: "20:13",
              aspectMode: "cover"
            },
            body: {
              type: "box",
              layout: "vertical",
              contents: [
                {
                  type: "text",
                  text: "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏à‡∏≤‡∏Å LIFF!",
                  weight: "bold",
                  size: "xl"
                },
                {
                  type: "text",
                  text: "‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üòä",
                  size: "md",
                  color: "#888888",
                  margin: "md"
                }
              ]
            }
          }
        };

        try {
          if (liff.isInClient()) {
            await liff.sendMessages([flex]);
            Swal.fire("‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß", "", "success");
          } else {
            const result = await liff.shareTargetPicker([flex]);
            if (result) {
              Swal.fire("‚úÖ ‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", "", "success");
            } else {
              Swal.fire("‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå", "", "info");
            }
          }
        } catch (err) {
          console.error("Send/share failed", err);
          Swal.fire("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", err.message, "error");
        }
      });

      document.getElementById("ScanBtn").addEventListener("click", async () => {
        try {
          const result = await liff.scanCodeV2();
          Swal.fire({
            icon: 'success',
            title: '‡∏™‡πÅ‡∏Å‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
            text: `‡∏Ñ‡πà‡∏≤: ${result.value}`
          });
        } catch (error) {
          console.error("QR scan failed", error);
          Swal.fire("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", error.message, "error");
        }
      });
    </script>
  </body>
</html>
